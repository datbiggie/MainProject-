{% load static %}
  {% include 'ecommerce_app/barra_superior_index.html' %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Inicio</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{% static 'index/style.css' %}">
    <link rel="stylesheet" href="{% static 'sucursal/css/main.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        .cart-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }
        .cart-card {
            transition: transform 0.2s ease-in-out;
        }
        .cart-card:hover {
            transform: translateY(-2px);
        }
        .empty-cart-icon {
            color: #6c757d;
            opacity: 0.5;
        }
        .total-section {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
    </style>







  </head>

    <body class="cart-container">

  



<div class="container-lg">
	<div class="card shadow mb-3" style="margin-top: 2rem; border-radius: 12px; border: none;">
		<div class="card-header bg-primary text-white" style="border-radius: 12px 12px 0 0;">
			<h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Detalle del Carrito</h5>
		</div>
		<div class="card-body p-3">
			{% if carrito_info %}
			<!-- Información del carrito -->
			<div class="row mb-4">
				<div class="col-md-3">
					<strong>ID Carrito:</strong><br>
					<span class="text-muted">#{{ carrito_info.id }}</span>
				</div>
				<div class="col-md-3">
					<strong>Estatus:</strong><br>
					<span class="badge bg-{% if carrito_info.estatus == 'activo' %}success{% else %}warning{% endif %}">
						{{ carrito_info.estatus|capfirst }}
					</span>
				</div>
				<div class="col-md-3">
					<strong>Fecha de Creación:</strong><br>
					<span class="text-muted">{{ carrito_info.fecha_creacion|date:"d/m/Y H:i" }}</span>
				</div>
				<div class="col-md-3">
					<strong>Propietario:</strong><br>
					<span class="text-muted">
						<i class="fas fa-{% if carrito_info.propietario.tipo == 'empresa' %}building{% else %}user{% endif %} me-1"></i>
						{{ carrito_info.propietario.nombre }}
					</span><br>
					<small class="text-muted">{{ carrito_info.propietario.email }}</small>
				</div>
			</div>

			<!-- Tabla de detalles del carrito -->
			<div class="row">
				<div class="col-12">
					<h6 class="mb-3"><i class="fas fa-list me-2"></i>Productos en el Carrito</h6>
					{% if productos_carrito %}
					<div class="table-responsive">
						<table class="table table-hover">
							<thead class="table-primary">
								<tr>
									<th scope="col">#</th>
									<th scope="col">Producto</th>
									<th scope="col">Cantidad</th>
									<th scope="col">Precio Unitario</th>
									<th scope="col">Subtotal</th>
									<th scope="col">Fecha Agregado</th>
									<th scope="col">Acciones</th>
								</tr>
							</thead>
							<tbody>
								{% for producto in productos_carrito %}
								<tr>
									<td>{{ forloop.counter }}</td>
									<td>
										<div class="d-flex align-items-center">
											<div class="me-3">
												{% if producto.imagen %}
													<img src="{{ producto.imagen }}" alt="{{ producto.nombre }}" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;">
												{% else %}
													<i class="fas fa-image text-muted" style="font-size: 2rem;"></i>
												{% endif %}
											</div>
											<div>
												<strong>{{ producto.nombre }}</strong><br>
												<small class="text-muted">Sucursal: {{ producto.sucursal }}</small>
											</div>
										</div>
									</td>
									<td>
										<span class="badge bg-secondary">{{ producto.cantidad }}</span>
									</td>
									<td>
										<strong>${{ producto.precio_unitario|floatformat:2 }}</strong>
									</td>
									<td>
										<strong class="text-success">${{ producto.subtotal|floatformat:2 }}</strong>
									</td>
									<td>
										<small class="text-muted">{{ producto.fecha_creacion_carrito|date:"d/m/Y H:i" }}</small>
									</td>
									<td>
										<div class="btn-group" role="group">
											<button type="button" class="btn btn-sm btn-outline-primary btn-editar" data-producto-id="{{ producto.id }}" title="Editar cantidad">
												<i class="fas fa-edit"></i>
											</button>
											<button type="button" class="btn btn-sm btn-outline-danger btn-eliminar" data-detalle-id="{{ producto.detalle_id }}" title="Eliminar">
												<i class="fas fa-trash"></i>
											</button>
										</div>
									</td>
								</tr>
								{% endfor %}
							</tbody>
							<tfoot class="table-light">
								<tr>
									<td colspan="4" class="text-end"><strong>Total del Carrito:</strong></td>
									<td><strong class="text-success fs-5">${{ total_productos|floatformat:2 }}</strong></td>
									<td colspan="2"></td>
								</tr>
							</tfoot>
						</table>
					</div>
					{% else %}
					<div class="text-center py-4">
						<i class="fas fa-shopping-cart empty-cart-icon" style="font-size: 2rem; margin-bottom: 1rem;"></i>
						<h6 class="text-muted mb-0">El carrito está vacío</h6>
						<p class="text-muted small mt-2">No hay productos agregados a este carrito.</p>
					</div>
					{% endif %}
				</div>
			</div>

			<!-- Botones de acción -->
			<div class="row mt-4">
				<div class="col-12 text-end">
					{% if productos_carrito %}
					<button type="button" class="btn btn-success" onclick="procederCompra()">
						<i class="fas fa-credit-card me-2"></i>Proceder a Compra
					</button>
					{% endif %}
				</div>
			</div>
			{% else %}
			<div class="text-center py-4">
				<i class="fas fa-shopping-cart empty-cart-icon" style="font-size: 3rem; margin-bottom: 1rem;"></i>
				<h6 class="text-muted mb-0">No existen carritos para este usuario</h6>
				<p class="text-muted small mt-2">Aún no tienes productos en tu carrito de compras.</p>
			</div>
			{% endif %}
		</div>
	</div>
	
     
</div>

<!-- Modal para editar cantidad -->
<div class="modal fade" id="editarCantidadModal" tabindex="-1" aria-labelledby="editarCantidadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarCantidadModalLabel">
                    <i class="fas fa-edit me-2"></i>Editar Cantidad
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img id="modal-producto-imagen" src="" alt="" class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover;">
                    <h6 id="modal-producto-nombre" class="mt-2 mb-0"></h6>
                    <small id="modal-producto-sucursal" class="text-muted"></small>
                </div>
                <div class="mb-3">
                    <label for="nueva-cantidad" class="form-label">Nueva cantidad:</label>
                    <div class="input-group">
                        <button class="btn btn-outline-secondary" type="button" id="btn-decrementar">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" class="form-control text-center" id="nueva-cantidad" min="1" max="99" value="1">
                        <button class="btn btn-outline-secondary" type="button" id="btn-incrementar">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="text-center">
                    <small class="text-muted">Precio unitario: $<span id="modal-precio-unitario">0.00</span></small><br>
                    <strong class="text-success">Nuevo subtotal: $<span id="modal-nuevo-subtotal">0.00</span></strong>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="btn-guardar-cantidad">
                    <i class="fas fa-save me-1"></i>Guardar
                </button>
            </div>
        </div>
    </div>
</div>

<div class="mb-5"></div>

    <script src="{% static 'index/js/jquery-1.11.0.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="{% static 'index/js/plugins.js' %}"></script>
    <script src="{% static 'index/js/script.js' %}"></script>
    <script src="{% static 'index/js/rating-system.js' %}"></script>
    
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'detalle_carrito/js/detalle_carrito.js' %}"></script>
  </body>
</html>