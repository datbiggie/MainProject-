{% load static %}
<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Vista Servicio</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'servicio_config/images/favicon.svg' %}" />

    <!-- ========================= CSS here ========================= -->

    <link rel="stylesheet" href="{% static 'servicio_config/css/LineIcons.3.0.css' %}" />
    <link rel="stylesheet" href="{% static 'servicio_config/css/animate.css' %}" />
    <link rel="stylesheet" href="{% static 'servicio_config/css/tiny-slider.css' %}" />
    <link rel="stylesheet" href="{% static 'servicio_config/css/glightbox.min.css' %}" />
    <link rel="stylesheet" href="{% static 'servicio_config/css/main.css' %}" />
    
    <!-- Bootstrap 5 CSS -->
   
    
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    <!-- Bootstrap 5 JS -->
    
    
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
   
</head>

<body>
{% include 'ecommerce_app/barra_superior_operaciones.html' %}

    <!-- Variables globales para JavaScript -->
   
    
    <!-- Start Features Area -->
    <div class="container" style="max-width: 1200px; margin-top: 2rem;" data-user-type="{{ user_info.tipo }}">
        <div class="card shadow-lg productos-bg-main border-0" style="border-radius: 1.2rem; padding: 2.2rem 1.5rem 2.2rem 1.5rem; box-shadow: 0 6px 32px rgba(44,62,80,0.10);">
            <h3 class="mb-4 text-center fw-bold" style="color: #2c3e50;">Gestión de Servicio</h3>
            <div class="search-section mb-4 w-100 d-flex justify-content-center" style="max-width: 700px; margin-left:auto; margin-right:auto;">
              <div class="card shadow-sm productos-bg-search" style="border-radius: 1rem; max-width: 1100px; margin: 0 auto;">
                <div class="card-body py-3 px-4">
                  <div class="row g-2 align-items-center flex-wrap justify-content-center" style="max-width:100%; margin:0 auto;">
                    <div class="col-lg-8 col-md-8 col-12 d-flex align-items-center gap-2 flex-wrap justify-content-center mb-2 mb-lg-0">
                      <input type="text" id="busqueda-producto" class="form-control productos-input" placeholder="Buscar servicio por nombre..." style="min-width:320px; max-width: 520px; width:100%;">
                    </div>
                    <div class="col-lg-4 col-md-4 col-12 d-flex align-items-center justify-content-center mb-2 mb-lg-0">
                      <a href="{% url 'servicio_funcion' %}" class="btn btn-sm d-inline-flex align-items-center btn-agregar-categoria" style="border-radius:2rem; font-size:0.98rem; padding: 0.35rem 1rem; font-weight:500;">
                        <i class="lni lni-plus me-1"></i> Agregar Servicio
                      </a>
                    </div>
                  </div>


                    </div>
                    
                  </div>
                  
                </div>
                 <div class="row" id="contenedor-productos">
                {% for servicio in servicio_all %}
                <div class="col-lg-4 col-md-6 col-12 wow fadeInUp" data-wow-delay=".2s">
                    <!-- Start Single Feature -->
                    <div class="single-featuer" style="max-width: 240px; min-width: 180px; width: 100%; border-radius: 0.7rem; padding: 0.7rem 0.7rem 0.5rem 0.7rem; margin: 0 auto; box-shadow: 0 2px 12px rgba(0,0,0,0.07);">
                        <img class="shape" src="{% static 'servicio_config/images/features/shape.svg' %}" alt="#" style="max-width: 32px;">
                        <img class="shape2" src="{% static 'servicio_config/images/features/shape2.svg' %}" alt="#" style="max-width: 32px;">
                        <span class="serial" style="font-size: 0.95rem;">{{ forloop.counter }}</span>
                        <div style="display: flex; align-items: center; justify-content: center; width: 100%; margin-bottom: 8px;">
                            {% if servicio.primera_imagen %}
                                {% if user_info.tipo == 'empresa' %}
                                    <img src="{{ servicio.primera_imagen.ruta_imagen_servicio_empresa.url }}" alt="Imagen del servicio" class="img-producto-hover" style="width: 60px; height: 60px; object-fit: cover; border-radius: 0.7rem; background: #f8f9fa; border: 1.5px solid #e0e0e0; box-shadow: 0 1px 6px rgba(0,0,0,0.08); display: block;">
                                {% else %}
                                    <img src="{{ servicio.primera_imagen.ruta_imagen_servicio_usuario.url }}" alt="Imagen del servicio" class="img-producto-hover" style="width: 60px; height: 60px; object-fit: cover; border-radius: 0.7rem; background: #f8f9fa; border: 1.5px solid #e0e0e0; box-shadow: 0 1px 6px rgba(0,0,0,0.08); display: block;">
                                {% endif %}
                            {% else %}
                                <i class="lni lni-cog" style="font-size: 2rem; color: #b0b0b0;"></i>
                            {% endif %}
                        </div>
                        {% if user_info.tipo == 'empresa' %}
                            <h3 style="font-size: 1rem; margin-bottom: 0.5rem; margin-top: 0.2rem; text-align: center;">{{ servicio.nombre_servicio_empresa }}</h3>
                            <div class="feature-buttons" style="display: flex; justify-content: center; gap: 0.3rem;">
                                <button href="#EditServiceModal" class="btn btn-edit" data-bs-toggle="modal" data-bs-target="#EditServiceModal"
                                        data-id="{{ servicio.id_servicio_empresa }}"
                                        data-nombre="{{ servicio.nombre_servicio_empresa }}"
                                        data-categoria="{{ servicio.id_categoria_servicios_fk.nombre_categoria_serv_empresa|default:'' }}"
                                        data-descripcion="{{ servicio.descripcion_servicio_empresa|default:'' }}"
                                        data-imagen="{% if servicio.primera_imagen %}{{ servicio.primera_imagen.ruta_imagen_servicio_empresa.url }}{% endif %}"
                                        data-user-type="{{ user_info.tipo }}">
                                    <i class="lni lni-pencil"></i> Editar
                                </button>
                                <button class="btn btn-delete" data-id="{{ servicio.id_servicio_empresa }}" data-nombre="{{ servicio.nombre_servicio_empresa }}" data-user-type="{{ user_info.tipo }}">
                                    <i class="lni lni-trash"></i> Eliminar
                                </button>
                            </div>
                        {% else %}
                            <h3 style="font-size: 1rem; margin-bottom: 0.5rem; margin-top: 0.2rem; text-align: center;">{{ servicio.nombre_servicio_usuario }}</h3>
                            <div class="feature-buttons" style="display: flex; justify-content: center; gap: 0.3rem;">
                                <button href="#EditServiceModal" class="btn btn-edit" data-bs-toggle="modal" data-bs-target="#EditServiceModal"
                                        data-id="{{ servicio.id_servicio_usuario }}"
                                        data-nombre="{{ servicio.nombre_servicio_usuario }}"
                                        data-categoria="{{ servicio.id_categoria_servicios_fk.nombre_categoria_serv_usuario|default:'' }}"
                                        data-descripcion="{{ servicio.descripcion_servicio_usuario|default:'' }}"
                                        data-precio="{{ servicio.precio_servicio_usuario|default:'0' }}"
                                        data-estatus="{{ servicio.estatus_servicio_usuario|default:'Activo' }}"
                                        data-imagen="{% if servicio.primera_imagen %}{{ servicio.primera_imagen.ruta_imagen_servicio_usuario.url }}{% endif %}"
                                        data-user-type="{{ user_info.tipo }}">
                                    <i class="lni lni-pencil"></i> Editar
                                </button>
                                <button class="btn btn-delete" data-id="{{ servicio.id_servicio_usuario }}" data-nombre="{{ servicio.nombre_servicio_usuario }}" data-user-type="{{ user_info.tipo }}">
                                    <i class="lni lni-trash"></i> Eliminar
                                </button>
                            </div>
                        {% endif %}
                    </div>
                    <!-- End Single Feature -->
                </div>
                {% endfor %}
            </div>
              </div>
              
            </div>
           
        </div>
    <!-- /End Features Area -->

    <!-- Modal de Edición de Producto ------->
    <div id="EditServiceModal" class="modal fade">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <form method="POST" action="#" id="editServiceForm" enctype="multipart/form-data" onsubmit="return false;">
                    {% csrf_token %}
                    {% if user_info.tipo == 'empresa' %}
                        <input type="hidden" name="id_servicio_empresa" id="edit_id_servicio_empresa">
                    {% else %}
                        <input type="hidden" name="id_servicio_usuario" id="edit_id_servicio_usuario">
                    {% endif %}
                    <div class="modal-header">
                        <h4 class="modal-title">Editar Servicio</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Nombre del Servicio</label>
                                    {% if user_info.tipo == 'empresa' %}
                                        <input type="text" class="form-control enhanced-input" name="nombre_servicio_empresa" id="edit_nombre_servicio" required>
                                    {% else %}
                                        <input type="text" class="form-control enhanced-input" name="nombre_servicio_usuario" id="edit_nombre_servicio" required>
                                    {% endif %}
                                </div>
                                <div class="form-group">
                                    <label>Categoría</label>
                                    <select class="form-control enhanced-input" name="categoria_servicio" id="edit_categoria_servicio" required>
                                        <option value="">Seleccione una categoría</option>
                                        {% for categoria in categoria_servicio_all %}
                                            {% if user_info.tipo == 'empresa' %}
                                                <option value="{{ categoria.id_categoria_serv_empresa }}">{{ categoria.nombre_categoria_serv_empresa }}</option>
                                            {% else %}
                                                <option value="{{ categoria.id_categoria_serv_usuario }}">{{ categoria.nombre_categoria_serv_usuario }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    {% if user_info.tipo == 'empresa' %}
                                        <textarea class="form-control enhanced-input" name="descripcion_servicio_empresa" id="edit_descripcion_servicio" style="height: 80px;"></textarea>
                                    {% else %}
                                        <textarea class="form-control enhanced-input" name="descripcion_servicio_usuario" id="edit_descripcion_servicio" style="height: 80px;"></textarea>
                                    {% endif %}
                                </div>
                                
                                <!-- Campos adicionales solo para usuarios con rol 'persona' -->
                                {% if user_info.tipo == 'persona' %}
                                <div class="form-group">
                                    <label>Precio</label>
                                    <input type="number" class="form-control enhanced-input" name="precio_servicio_usuario" id="edit_precio_servicio" step="0.01" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Estatus</label>
                                    <select class="form-control enhanced-input" name="estatus_servicio_usuario" id="edit_estatus_servicio">
                                        <option value="Activo">Activo</option>
                                        <option value="Inactivo">Inactivo</option>
                                    </select>
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Imágenes Actuales del Servicio</label>
                                    <div id="current_images_container_servicio" class="row mb-3" data-user-type="{{ user_info.tipo }}">
                                        <!-- Las imágenes actuales se cargarán aquí dinámicamente -->
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="edit_imagenes_servicio" class="form-label">Agregar Nuevas Imágenes</label>
                                    <div class="file-upload-wrapper" style="max-width: 200px;">
                                        <div class="file-upload-container">
                                            <input type="file" name="imagenes_servicio" id="edit_imagenes_servicio" class="form-control file-input" accept="image/*" multiple>
                                            <div class="file-upload-placeholder">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="#536387" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M17 8L12 3L7 8" stroke="#536387" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M12 3V15" stroke="#536387" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                <span>Agregar más imágenes</span>
                                            </div>
                                            <div class="image-preview" id="edit_imagePreview_servicio"></div>
                                        </div>
                                    </div>
                                    <div class="form-text">Puedes agregar más imágenes (máximo 5 en total).</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================= Enhanced Input Styles ========================= -->
    <style>
        .enhanced-input {
            border: 1px solid #e0e0e0 !important;
            border-radius: 6px !important;
            padding: 12px 15px !important;
            font-size: 14px !important;
            transition: all 0.3s ease !important;
            box-shadow: none !important;
            color: #333 !important;
        }
        
        .enhanced-input:focus {
            border-color: #2196F3 !important;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.1) !important;
            outline: none !important;
        }
        
        .enhanced-input::placeholder {
            color: #999 !important;
        }
        
        .enhanced-input[type="select"], select.enhanced-input {
            appearance: none !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: right 15px center !important;
            padding-right: 35px !important;
        }
        
        textarea.enhanced-input {
            resize: vertical !important;
            min-height: 100px !important;
        }
        
        .modal label {
            color: #000 !important;
            font-weight: 500 !important;
            margin-bottom: 8px !important;
            font-size: 14px !important;
        }
    </style>

    <!-- ========================= JS here ========================= -->
    <script src="{% static 'servicio_config/js/wow.min.js' %}"></script>
    <script src="{% static 'servicio_config/js/tiny-slider.js' %}"></script>
    <script src="{% static 'servicio_config/js/glightbox.min.js' %}"></script>
    <script src="{% static 'servicio_config/js/count-up.min.js' %}"></script>
    <script src="{% static 'servicio_config/js/main.js' %}"></script>
    <script src="{% static 'servicio_config/js/servicio_config.js' %}"></script>
    <script src="{% static 'servicio_config/js/filtrado.js' %}"></script>
</body>

</html>