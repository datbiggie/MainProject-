{% load static %}
<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Vista Productos</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'producto_sucursal/images/favicon.svg' %}" />

    <!-- ========================= CSS here ========================= -->

    <link rel="stylesheet" href="{% static 'producto_sucursal/css/LineIcons.3.0.css' %}" />
    <link rel="stylesheet" href="{% static 'producto_sucursal/css/animate.css' %}" />
    <link rel="stylesheet" href="{% static 'producto_sucursal/css/tiny-slider.css' %}" />
    <link rel="stylesheet" href="{% static 'producto_sucursal/css/glightbox.min.css' %}" />
    <link rel="stylesheet" href="{% static 'producto_sucursal/css/main.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
   
</head>

<body>
{% include 'ecommerce_app/barra_superior_operaciones.html' %}

    <!-- Variables globales para JavaScript -->
   
    
    <!-- Start Features Area -->
    <div class="container" style="max-width: 1200px; margin-top: 2rem;">
        <div class="card shadow-lg productos-bg-main border-0" style="border-radius: 1.2rem; padding: 2.2rem 1.5rem 2.2rem 1.5rem; box-shadow: 0 6px 32px rgba(44,62,80,0.10);">
            <h3 class="mb-4 text-center fw-bold" style="color: #2c3e50;">Gestión de Productos</h3>
            <div class="search-section mb-4 w-100 d-flex justify-content-center" style="max-width: 700px; margin-left:auto; margin-right:auto;">
              <div class="card shadow-sm productos-bg-search" style="border-radius: 1rem; max-width: 1100px; margin: 0 auto;">
                <div class="card-body py-3 px-4">
                  <div class="row g-2 align-items-center flex-wrap justify-content-center" style="max-width:100%; margin:0 auto;">
                    <div class="col-lg-6 col-md-6 col-12 d-flex align-items-center gap-2 flex-wrap justify-content-center mb-2 mb-lg-0">
                      <input type="text" id="busqueda-producto" class="form-control productos-input" placeholder="Buscar producto por nombre..." style="min-width:320px; max-width: 520px; width:100%;">
                    </div>
                    <div class="col-lg-6 col-md-6 col-12 d-flex align-items-center gap-2 flex-wrap justify-content-center mb-2 mb-lg-0">
                      <button class="btn btn-outline-primary btn-sm filtro-estado-producto" data-estado="todos" style="border-radius:1.2rem; min-width:90px;">Todos</button>
                      <button class="btn btn-outline-success btn-sm filtro-estado-producto" data-estado="activo" style="border-radius:1.2rem; min-width:90px;">Activos</button>
                      <button class="btn btn-outline-secondary btn-sm filtro-estado-producto" data-estado="inactivo" style="border-radius:1.2rem; min-width:90px;">Inactivos</button>
                    </div>
                  </div>
                  <div class="row mt-3">
                    <div class="col-12 d-flex justify-content-start">
                      <a href="{% url 'producto_funcion' %}" class="btn btn-sm ms-1 d-inline-flex align-items-center btn-agregar-categoria" style="border-radius:2rem; font-size:0.98rem; padding: 0.35rem 1rem; font-weight:500;">
                        <i class="lni lni-plus me-1"></i> Agregar Producto
                      </a>
<style>
.btn-agregar-categoria {
  background: #4a90e2 !important;
  color: #fff !important;
  border: none !important;
  border-radius: 1.2rem !important;
  font-size: 0.98rem !important;
  padding: 0.45rem 1.2rem !important;
  font-weight: 500 !important;
  min-width: 180px;
  display: inline-flex;
  align-items: center;
  transition: background 0.18s;
}
.btn-agregar-categoria:hover {
  background: #357ab8 !important;
  color: #fff !important;
}
</style>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row" id="contenedor-productos">
                {% for producto_all in producto_sucursal_all %}
                <div class="col-lg-4 col-md-6 col-12 wow fadeInUp" data-wow-delay=".2s">
                    <!-- Start Single Feature -->
                    <div class="single-featuer" style="max-width: 240px; min-width: 180px; width: 100%; border-radius: 0.7rem; padding: 0.7rem 0.7rem 0.5rem 0.7rem; margin: 0 auto; box-shadow: 0 2px 12px rgba(0,0,0,0.07);">
                        <img class="shape" src="{% static 'producto_sucursal/images/features/shape.svg' %}" alt="#" style="max-width: 32px;">
                        <img class="shape2" src="{% static 'producto_sucursal/images/features/shape2.svg' %}" alt="#" style="max-width: 32px;">
                        <span class="serial" style="font-size: 0.95rem;">{{ forloop.counter }}</span>
                        <div style="display: flex; align-items: center; justify-content: center; width: 100%; margin-bottom: 8px;">
                            {% if producto_all.primera_imagen and producto_all.primera_imagen.ruta_imagen %}
                                <img src="{{ producto_all.primera_imagen.ruta_imagen.url }}" alt="Imagen del producto" class="img-producto-hover" style="width: 60px; height: 60px; object-fit: cover; border-radius: 0.7rem; background: #f8f9fa; border: 1.5px solid #e0e0e0; box-shadow: 0 1px 6px rgba(0,0,0,0.08); display: block;">
                            {% else %}
                                <i class="lni lni-microphone" style="font-size: 2rem; color: #b0b0b0;"></i>
                            {% endif %}
                        </div>
                        <h3 style="font-size: 1rem; margin-bottom: 0.5rem; margin-top: 0.2rem; text-align: center;">{{ producto_all.nombre_producto }}</h3>
                        <div class="feature-buttons" style="display: flex; justify-content: center; gap: 0.3rem;">
                            <button href="#EditProductModal" class="btn btn-edit" data-bs-toggle="modal" data-bs-target="#EditProductModal"
                                    data-id="{{ producto_all.id_producto }}"
                                    data-nombre="{{ producto_all.nombre_producto }}"
                                    data-marca="{{ producto_all.marca_producto|default:'' }}"
                                    data-modelo="{{ producto_all.modelo_producto|default:'' }}"
                                    data-categoria="{{ producto_all.id_categoria_prod_fk.nombre_categoria_prod|default:'' }}"
                                    data-descripcion="{{ producto_all.descripcion_producto|default:'' }}"
                                    data-caracteristicas="{{ producto_all.caracteristicas_generales|default:'' }}"
                                    data-imagen="{% if producto_all.primera_imagen and producto_all.primera_imagen.ruta_imagen %}{{ producto_all.primera_imagen.ruta_imagen.url }}{% endif %}">
                                <i class="lni lni-pencil"></i> Editar
                            </button>
                            <button class="btn btn-delete" data-id="{{ producto_all.id_producto }}" data-nombre="{{ producto_all.nombre_producto }}">
                                <i class="lni lni-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                    <!-- End Single Feature -->
                </div>
                {% endfor %}
            </div>
        </div>
    <!-- /End Features Area -->

    <!-- Modal de Edición de Producto ------->
    <div id="EditProductModal" class="modal fade">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <form method="POST" action="{% url 'editar_producto' %}" id="editProductoForm" enctype="multipart/form-data" onsubmit="return false;">
                    {% csrf_token %}
                    <input type="hidden" name="id_producto" id="edit_id_producto">
                    <div class="modal-header">
                        <h4 class="modal-title">Editar Producto</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Nombre del Producto</label>
                                    <input type="text" class="form-control enhanced-input" name="nombre_producto" id="edit_nombre" required>
                                </div>
                                <div class="form-group">
                                    <label>Marca</label>
                                    <input type="text" class="form-control enhanced-input" name="marca_producto" id="edit_marca">
                                </div>
                                <div class="form-group">
                                    <label>Modelo</label>
                                    <input type="text" class="form-control enhanced-input" name="modelo_producto" id="edit_modelo">
                                </div>
                                <div class="form-group">
                                    <label>Categoría</label>
                                    <select class="form-control enhanced-input" name="categoria_producto" id="edit_categoria" required>
                                        <option value="">Seleccione una categoría</option>
                                        {% for categoria in categoria_producto_all  %}
                                            <option value="{{ categoria.id_categoria_prod }}">{{ categoria.nombre_categoria_prod }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="form-control enhanced-input" name="descripcion_producto" id="edit_descripcion" style="height: 80px;"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Características Generales</label>
                                    <textarea class="form-control enhanced-input" name="caracteristicas_generales" id="edit_caracteristicas" style="height: 80px;" required></textarea>
                                </div>
                                <!-- El campo estatus_producto se ha eliminado ya que ahora está en producto_sucursal -->
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Imágenes Actuales del Producto</label>
                                    <div id="current_images_container" class="row mb-3">
                                        <!-- Las imágenes actuales se cargarán aquí dinámicamente -->
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Agregar Nuevas Imágenes</label>
                                    <div class="file-upload-wrapper" style="max-width: 200px;">
                                        <div class="file-upload-container">
                                            <input type="file" name="imagenes_producto" id="edit_imagenes_producto" class="form-control file-input" accept="image/*" multiple>
                                            <div class="file-upload-placeholder">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="#536387" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M17 8L12 3L7 8" stroke="#536387" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M12 3V15" stroke="#536387" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                <span>Agregar más imágenes</span>
                                            </div>
                                            <div class="image-preview" id="edit_imagePreview"></div>
                                        </div>
                                    </div>
                                    <div class="form-text">Puedes agregar más imágenes (máximo 5 en total).</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================= Enhanced Input Styles ========================= -->
    <style>
        .enhanced-input {
            border: 1px solid #e0e0e0 !important;
            border-radius: 6px !important;
            padding: 12px 15px !important;
            font-size: 14px !important;
            transition: all 0.3s ease !important;
            box-shadow: none !important;
            color: #333 !important;
        }
        
        .enhanced-input:focus {
            border-color: #2196F3 !important;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.1) !important;
            outline: none !important;
        }
        
        .enhanced-input::placeholder {
            color: #999 !important;
        }
        
        .enhanced-input[type="select"], select.enhanced-input {
            appearance: none !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: right 15px center !important;
            padding-right: 35px !important;
        }
        
        textarea.enhanced-input {
            resize: vertical !important;
            min-height: 100px !important;
        }
        
        .modal label {
            color: #000 !important;
            font-weight: 500 !important;
            margin-bottom: 8px !important;
            font-size: 14px !important;
        }
    </style>
    
    <!-- ========================= JS here ========================= -->
    <script src="{% static 'producto_sucursal/js/wow.min.js' %}"></script>
    <script src="{% static 'producto_sucursal/js/tiny-slider.js' %}"></script>
    <script src="{% static 'producto_sucursal/js/glightbox.min.js' %}"></script>
    <script src="{% static 'producto_sucursal/js/count-up.min.js' %}"></script>
    <script src="{% static 'producto_sucursal/js/main.js' %}"></script>
    <script src="{% static 'producto_sucursal/js/producto_config.js' %}"></script>
    <script src="{% static 'producto_sucursal/js/filtrado.js' %}"></script>
</body>

</html>